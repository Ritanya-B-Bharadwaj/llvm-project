{
    "number": 138520,
    "title": "[OpenMP] Fix __builtin_return_address calls for SPARC",
    "body": "`libomp` uses `__builtin_return_address` in two places.  However, on some targets those calls need to wrapped in `___builtin_extract_return_addr` to get at the actual return address.  SPARC is among those targets and the only one where `clang` actually implements this, cf. [[clang][Sparc] Fix __builtin_extract_return_addr etc.](https://reviews.llvm.org/D91607). `compiler-rt` needed the same adjustment, cf. [[sanitizer_common][test] Enable tests on SPARC](https://reviews.llvm.org/D91608). On other targets, this is a no-op.  However, there are more targets that have the same issue and `gcc`, unlike `clang`, correctly implements it, so there might be issues when building `libomp` with `gcc`.\r\n\r\nThis patch adds the necessary calls.\r\n\r\nTested on `sparcv9-sun-solaris2.11`, `sparc64-unknown-linux-gnu`, `amd64-pc-solaris2.11`, and `x86_64-pc-linux-gnu`.",
    "created_at": "2025-05-05T12:36:40Z",
    "merged_at": "2025-05-14T11:11:20Z",
    "user": "rorth",
    "files": [
        "openmp/runtime/src/ompt-internal.h",
        "openmp/runtime/src/ompt-specific.h"
    ],
    "commits": [
        "[OpenMP] Fix __builtin_return_address calls for SPARC\n\n`libomp` uses `__builtin_return_address` in two places.  However, on some\ntargets those calls need to wrapped in `___builtin_extract_return_addr` to\nget at the actual return address.  SPARC is among those targets and the\nonly one where `clang` actually implements this, cf.\n[[clang][Sparc] Fix __builtin_extract_return_addr etc.](https://reviews.llvm.org/D91607).\nOn other targets, this is a no-op.  However, there are more targets that\nhave the same issue and `gcc`, unlike `clang`, correctly implements it, so\nthere might be issues when building `libomp` with `gcc`.\n\nThis patch adds the necessary calls.\n\nTested on `sparcv9-sun-solaris2.11`, `sparc64-unknown-linux-gnu`,\n`amd64-pc-solaris2.11`, and `x86_64-pc-linux-gnu`."
    ]
}