{
    "number": 142379,
    "title": "[OpenMP] Don't use libproc on Solaris",
    "body": "`openmp` currently doesn't compile on 32-bit Solaris:\r\n\r\n```\r\nFAILED: projects/openmp/runtime/src/CMakeFiles/omp.dir/z_Linux_util.cpp.o\r\n[...]\r\nIn file included from openmp/runtime/src/z_Linux_util.cpp:78:\r\nIn file included from /usr/include/libproc.h:25:\r\nIn file included from /usr/include/gelf.h:10:\r\n/usr/include/libelf.h:22:2: error: \"large files are not supported by libelf\"\r\n   22 | #error \"large files are not supported by libelf\"\r\n      |  ^\r\nIn file included from openmp/runtime/src/z_Linux_util.cpp:78:\r\n/usr/include/libproc.h:42:2: error: \"Cannot use libproc in the large file compilation environment\"\r\n   42 | #error \"Cannot use libproc in the large file compilation environment\"\r\n      |  ^\r\n```\r\n\r\nLooking closer, there's no point in using `Pgrab` (the only interface from `<libproc.h>`) at all: the resulting `ps_prochandle_t *` isn't used in the remainder of the code and the original PR #82930 gives no indication why it is deemed necessary/useful.\r\n\r\nWhile at it, this patch switches to use `/proc/self/xmap`, matching `compiler-rt`'s `sanitizer_procmaps_solaris.cpp`, and makes some minor formatting fixes.\r\n\r\nTested on `sparc-sun-solaris2.11`, `sparcv9-sun-solaris2.11`, `i386-pc-solaris2.11`, and `amd64-pc-solaris2.11`.",
    "created_at": "2025-06-02T12:44:33Z",
    "merged_at": "2025-06-04T08:28:38Z",
    "user": "rorth",
    "files": [
        "openmp/runtime/cmake/LibompHandleFlags.cmake",
        "openmp/runtime/src/z_Linux_util.cpp"
    ],
    "commits": [
        "[OpenMP] Don't use libproc on Solaris\n\n`openmp` currently doesn't compile on 32-bit Solaris:\n\n```\nFAILED: projects/openmp/runtime/src/CMakeFiles/omp.dir/z_Linux_util.cpp.o\n[...]\nIn file included from openmp/runtime/src/z_Linux_util.cpp:78:\nIn file included from /usr/include/libproc.h:25:\nIn file included from /usr/include/gelf.h:10:\n/usr/include/libelf.h:22:2: error: \"large files are not supported by libelf\"\n   22 | #error \"large files are not supported by libelf\"\n      |  ^\nIn file included from openmp/runtime/src/z_Linux_util.cpp:78:\n/usr/include/libproc.h:42:2: error: \"Cannot use libproc in the large file compilation environment\"\n   42 | #error \"Cannot use libproc in the large file compilation environment\"\n      |  ^\n```\n\nLooking closer, there's no point in using `Pgrab` (the only interface from\n`<libproc.h>`) at all: the resulting `ps_prochandle_t *` isn't used in the\nremainder of the code and the original PR #82930 gives no indication why it\nis deemed necessary/useful.\n\nWhile at it, this patch switches to use `/proc/self/xmap`, matching\n`compiler-rt`'s `sanitizer_procmaps_solaris.cpp`, and makes some minor\nformatting fixes.\n\nTested on `sparc-sun-solaris2.11`, `sparcv9-sun-solaris2.11`,\n`i386-pc-solaris2.11`, and `amd64-pc-solaris2.11`."
    ]
}