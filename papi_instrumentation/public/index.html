<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>PAPI Profiler UI</title>
  <style>
    body { font-family: Arial; margin: 20px; }
    label { display: block; margin-top: 10px; font-weight: bold; }
    .event-list { max-height: 200px; overflow-y: scroll; border: 1px solid #ccc; padding: 10px; }
    button { margin-top: 20px; }
  </style>
</head>
<body>
  <h1>Run PAPI Profiler</h1>
  <form action="/run" method="post" enctype="multipart/form-data">
    <label>Upload Test File (.c):
      <input type="text" name="testfile" required>
    </label>

    <label>Select PAPI Events:</label>
    <div class="event-list" id="eventList">
      <!-- dynamically populated via JS -->
    </div>
    <button type="button" onclick="toggleAll(true)">Select All</button>
    <button type="button" onclick="toggleAll(false)">Deselect All</button>

    <label>Output File Name:
      <input type="text" name="output" placeholder="function_metrics.csv">
    </label>

    <input type="hidden" id="eventsInput" name="events" />
    <button type="submit" onclick="prepareEvents()">Run Script</button>
  </form>
  <img src = "./im1.png" width = "50%">
  <img src = "./im2.png" width = "50%">

  <script>
    const papiEvents = [
      "PAPI_L1_DCM", "PAPI_L1_ICM", "PAPI_L2_DCM", "PAPI_L2_ICM",
      "PAPI_L3_TCM", "PAPI_CA_SHR", "PAPI_CA_CLN", "PAPI_CA_INV",
      "PAPI_TLB_DM", "PAPI_TLB_IM", "PAPI_BR_MSP", "PAPI_BR_PRC",
      "PAPI_TOT_INS", "PAPI_TOT_CYC", "PAPI_FP_INS", "PAPI_FP_OPS"
    ];

    function populateEvents() {
      const container = document.getElementById('eventList');
      papiEvents.forEach(event => {
        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.name = 'eventbox';
        checkbox.value = event;

        const label = document.createElement('label');
        label.appendChild(checkbox);
        label.append(` ${event}`);
        container.appendChild(label);
      });
    }

    function toggleAll(selectAll) {
      document.querySelectorAll('input[name="eventbox"]').forEach(cb => cb.checked = selectAll);
    }

    function prepareEvents() {
      const selected = Array.from(document.querySelectorAll('input[name="eventbox"]:checked'))
        .map(cb => cb.value)
        .join(',');
      document.getElementById('eventsInput').value = selected;
    }

    populateEvents();
  </script>
</body>
</html>
